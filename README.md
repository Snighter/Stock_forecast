## 股票价格预测

### 1. 数据收集与保存

- 使用 `baostock` API 获取股票和指数数据。

- 从指定文件或列表中读取股票代码（包括 si 和 st），并循环获取每只股票的相关数据。

- 将数据保存为 CSV 文件，存放在 `out/code_data` 文件夹中，保存所有股票代码列表。

### 2. 数据预处理

- 检查缺失值：`check_missing_values` 用于检查数据中的缺失值。

- 检查数据类型：`check_data_types` 用于确认数据列类型是否符合预期。

- 对日线数据（`*_d_data.csv`）和 15分钟数据（`*_15m_data.csv`）进行预处理，确保数据没有缺失且列类型正确。

### 3. 平稳性检验

- 使用 ADF（Augmented Dickey-Fuller）检验和 KPSS（Kwiatkowski-Phillips-Schmidt-Shin）检验来检查数据的平稳性。

+ 对每只股票的以下特征进行平稳性检验：

  - 日线数据：`open`，`close`，`pctChg`，`open_pctChg`

  - 15分钟数据：`open_diff`，`close_diff`

- 将平稳性检验结果（包括 ADF 和 KPSS 的统计值和 p-value）保存在 `results_d` 和 `results_15m` 列表中，并最终保存为 CSV 文件（`stationarity_results_d.csv` 和 `stationarity_results_15m.csv`）。

- 输出平稳性统计信息，展示每个变量在日线数据和15分钟数据中的平稳性检验结果。

### 4. 特征提取与训练模型

+ 从两个不同的数据集提取特征和预测目标：

  - 特征：`open`（开盘价），`close`（收盘价），`high`（最高价），`low`（最低价），`volume`（成交量），`amount`（成交额）。

  - 目标变量1：`pctChg`（收盘收益率）和 `open_pctChg`（开盘收益率）。

  - 目标变量2：`close_diff`（收盘差）和 `open_diff`（开盘差）。

- 使用随机森林基准模型来预测两个目标变量，提取并可视化特征重要性，帮助理解各个特征对预测的影响。

### 5. 数据归一化与准备

- 使用 `MinMaxScaler` 对数据进行归一化处理，确保数据在相同的尺度下。

- 构建适合用于 GRU 模型的数据集，转化为时间序列格式。

### 6. GRU 模型设计与训练

- 比较 GRU 和 LSTM 神经网络模型，发现两模型在股票预测问题的该数据集上，实际效果差不多，但时间效率上 GRU 模型更优。且应该更注重于近期的数据，LSTM 的长期记忆不能有效提高模型预测效果，故选择 GRU 模型。

+ 设计 GRU 神经网络模型：

  - 模型包含三层 GRU 和 Dropout 层，旨在减少过拟合。

  - 对每个目标变量分别训练 GRU 模型，使用 Adam优化器和均方误差（MSE）作为损失函数。

+ 分别训练两个独立的 GRU 模型：

  - `model_open`：预测开盘价。

  - `model_close`：预测收盘价。

### 7. 未来预测

- 使用过去20天的数据（`n_steps=20`）进行未来5天的预测。

- 每次预测时，利用之前的预测结果作为输入，更新模型并进行多次迭代，逐步预测未来的开盘和收盘价格。

- 对预测的收益率进行反归一化，恢复成实际的开盘价和收盘价，并保存预测结果。

### 8. RMSE计算与评估

+ 训练完成后，使用 RMSE（均方根误差）评估模型预测结果的表现。

  - 将预测的收益率转化为实际价格，与真实数据进行对比，计算误差。

- 评估结果用于检查模型的精度，并调整模型参数。

### 9. 结果保存与文件输出

- 将每只股票的预测结果（包括日期、预测的开盘和收盘价格）保存到 CSV 文件中。

- 加权平均计算：对开盘价和收盘价的预测结果进行加权平均，30% 权重给日线预测，70% 权重给15分钟预测。

- 将加权平均结果保存到文件中，便于后续查看和分析。
